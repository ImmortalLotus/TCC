FROM REGISTRY_LOCAL_DA_SETIC/dotnet/sdk:6.0

ENV DOTNET_NUGET_SOURCES=REPOSITORIO_LOCAL_DA_SETIC
ENV DOTNET_RESTORE_SOURCES="${DOTNET_NUGET_SOURCES}"

ENV PROJECT_SOLUTION_PATH="OrcHestrador.WorkerService"

# ADICIONADO AUTORIDADE CERTIFICADORA PARA ALPINE, DEBIAN, UBUNTU E DISTRIBUIES DERIVADAS
RUN curl -fsSL CERTIFICADOS DA SETIC
RUN curl -fsSL CERTIFICADOS DA SETIC
RUN update-ca-certificates

# COPY CSPROJ AND RESTORE AS DISTINCT LAYERS
COPY ./ /source

# SETA O DIRETORIO BASE PARA DOTNET RESTORE E PUBLISH
WORKDIR /source/src/"${PROJECT_SOLUTION_PATH}"

# RESTAURAO EXPLCITA PARA PACOTES NUGET
RUN dotnet restore --verbosity d --source "${DOTNET_NUGET_SOURCES}"

# COMPILA O CODIGO PARA IMPLANTAO EM UM SISTEMA DE HOSPEDAGEM
RUN dotnet publish --no-restore -c release -o /app

# SETA O DIRETORIO BASE PARA ENTRYPOINT
WORKDIR /app

ENTRYPOINT dotnet "${PROJECT_SOLUTION_PATH}".dll
	